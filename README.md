# vcenter-connector

vcenter-connector is an OpenFaaS event connector built to consume events from vCenter.

[![Build Status](https://travis-ci.org/openfaas-incubator/vcenter-connector.svg?branch=master)](https://travis-ci.org/openfaas-incubator/vcenter-connector)

## Overview

With this project your functions can subscribe to events generated by the changes (i.e. events) in your vCenter installation - for instance a VM being created, turned on or deleted. This allows you to extend vCenter's functionality by writing functions to execute each time an event is fired. An example may be tagging a VM with the date it was last turned on or applying a tag showing which user made a change to an object. 

## Status

This project uses the [OpenFaaS Connector SDK](https://github.com/openfaas-incubator/connector-sdk).

The code is under **active development** and only suitable for early adopters. For the initial version the vCenter user credentials need to be stored in plain-text in your YAML files, but this will move to using [OpenFaaS secrets](https://docs.openfaas.com/reference/secrets/) in the next version.

## Supported Events

The following event types (incl. their subtypes) are supported and can be used to trigger functions:

- Alarm Event, e.g. `AlarmCreatedEvent`
- Datastore Event, e.g. `DatastoreDestroyedEvent`
- Host Event, e.g. `HostDisconnectedEvent`
- Resource Pool Event, e.g. `ResourcePoolCreatedEvent`
- VM Event, e.g. `VmPoweredOnEvent`

For further details and naming see the [vSphere Web Services API](https://code.vmware.com/apis/358/vsphere#/doc/vim.event.Event.html) documentation.

## Credentials

### Credentials within Kubernetes

When using the connector in Kubernetes, you will need to create a secret for the connector in the `openfaas` namespace.

```sh
kubectl create secret generic vcenter-secrets \
  -n openfaas \
  --from-literal vcenter-username=user \
  --from-literal vcenter-password=pass
```

At runtime these secrets will be mounted at `/var/openfaas/secrets/`. See [/yaml/kubernetes/connector-dep.yml](/yaml/kubernetes/connector-dep.yml) for more.

### Using credentials outside of Kubernetes

You can pass credentials via arguments (not recommended).

```sh
./vcenter-connector \
  -vc-user="admin" \
  -vc-pass="test1234" \
```

Or use a file and pass the name:

```sh
export secret_mount_path="/tmp/secrets/`

./vcenter-connector \
  -vc-user="" \
  -vc-pass="" \
  -vc-user-secret-name=vcenter-username \
  -vc-password-secret-name=vcenter-password
```

The default path is `/var/openfaas/secrets/` which can be overridden by setting the `secret_mount_path` environment variable.

## Example

You can find a detailed example using vSphere tags for `VmPoweredOnEvent` [here](docs/example.md). You might also want to check out Robert Guske's [blog](https://rguske.github.io/post/event-driven-interactions-with-vsphere-using-functions-as-a-service/) post on how he automated the integration between several VMware products with OpenFaaS and this vcenter-connector.

## License

MIT

## Acknowledgements

This project is hosted and maintained by [OpenFaaS Ltd](https://www.openfaas.com/)

It makes use of the following components:

* [govmomi](https://github.com/vmware/govmomi) project providing Golang bindings for vCenter by Doug MacEachern, VMware
* [vcsim](https://github.com/vmware/govmomi/blob/master/vcsim/README.md) simulator tool by Doug MacEachern, VMware

The contact for VMware is [Michael Gasch (VMware)](https://github.com/embano1)
The contact for OpenFaaS Ltd is [Alex Ellis](https://github.com/alexellis)
